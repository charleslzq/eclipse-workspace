package src.tool;

import java.awt.geom.Rectangle2D;
import java.io.IOException;
import java.io.StringWriter;
import java.util.*;

import org.apache.pdfbox.cos.COSStream;
import org.apache.pdfbox.pdmodel.PDPage;
import org.apache.pdfbox.pdmodel.common.PDStream;
import org.apache.pdfbox.util.PDFTextStripper;
import org.apache.pdfbox.util.TextPosition;

public class TextStripperByRectangleObject extends PDFTextStripper {
	private List<String> regions = new ArrayList<String>();
    private Map<Integer,RectangleObject> regionArea = new HashMap<Integer,RectangleObject>();
    private Map<String,Vector<ArrayList<TextPosition>>> regionCharacterList = 
        new HashMap<String,Vector<ArrayList<TextPosition>>>();
    private Map<String,StringWriter> regionText = new HashMap<String,StringWriter>();

	@SuppressWarnings("deprecation")
	public TextStripperByRectangleObject() throws IOException {
		super();
		// TODO Auto-generated constructor stub
		setPageSeparator( "" );
	}
	
	public void addRegion( int areaNo, Rectangle2D rect )
    {
        regions.add( regionName );
        regionArea.put( regionName, rect );
    }
	
	 public String getTextForRegion( String regionName ){
	        StringWriter text = regionText.get( regionName );
	        return text.toString();
	 }
	 
	 public void extractRegions( PDPage page ) throws IOException{
	        Iterator<String> regionIter = regions.iterator();
	        while( regionIter.hasNext() )
	        {
	            setStartPage(getCurrentPageNo());
	            setEndPage(getCurrentPageNo());
	            //reset the stored text for the region so this class
	            //can be reused.
	            String regionName = regionIter.next();
	            Vector<ArrayList<TextPosition>> regionCharactersByArticle = new Vector<ArrayList<TextPosition>>();
	            regionCharactersByArticle.add( new ArrayList<TextPosition>() );
	            regionCharacterList.put( regionName, regionCharactersByArticle );
	            regionText.put( regionName, new StringWriter() );
	        }

	        PDStream contentStream = page.getContents();
	        if( contentStream != null )
	        {
	            COSStream contents = contentStream.getStream();
	            processPage( page, contents );
	        }
	    }

}
